<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = '';
        }
    </script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        #status {
            padding: 10px;
            background: #f0f0f0;
            margin: 10px 0;
        }

        #canvas {
            border: 1px solid #ccc;
            margin-top: 20px;
        }

        .error {
            color: red;
        }

        .success {
            color: green;
        }
    </style>
</head>

<body>
    <h1>PDF Upload Test</h1>
    <input type="file" id="file-input" accept=".pdf">
    <div id="status">Wacht op bestand...</div>
    <canvas id="canvas"></canvas>

    <script>
        const fileInput = document.getElementById('file-input');
        const status = document.getElementById('status');
        const canvas = document.getElementById('canvas');

        function log(msg, isError = false) {
            console.log(msg);
            status.innerHTML += `<div class="${isError ? 'error' : ''}">${msg}</div>`;
        }

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) {
                log('Geen bestand geselecteerd', true);
                return;
            }

            status.innerHTML = '';
            log(`Bestand: ${file.name} (${file.size} bytes, type: ${file.type})`);

            try {
                log('Lezen als ArrayBuffer...');
                const arrayBuffer = await file.arrayBuffer();
                log(`ArrayBuffer size: ${arrayBuffer.byteLength}`);

                const uint8Array = new Uint8Array(arrayBuffer);
                log(`Uint8Array length: ${uint8Array.length}`);

                // Check PDF header
                const header = String.fromCharCode(...uint8Array.slice(0, 8));
                log(`PDF Header: "${header}"`);

                if (!header.startsWith('%PDF')) {
                    log('WAARSCHUWING: Geen valid PDF header gevonden!', true);
                }

                log('Laden met PDF.js...');
                const loadingTask = pdfjsLib.getDocument({ data: uint8Array });

                loadingTask.promise.then(async (pdfDoc) => {
                    log(`<span class="success">✓ PDF geladen! ${pdfDoc.numPages} pagina(s)</span>`);

                    // Render first page
                    const page = await pdfDoc.getPage(1);
                    const viewport = page.getViewport({ scale: 1.0 });

                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    const ctx = canvas.getContext('2d');
                    await page.render({
                        canvasContext: ctx,
                        viewport: viewport
                    }).promise;

                    log('<span class="success">✓ Pagina 1 gerenderd!</span>');
                }).catch(err => {
                    log(`PDF.js error: ${err.message}`, true);
                    console.error(err);
                });

            } catch (error) {
                log(`Fout: ${error.message}`, true);
                console.error(error);
            }
        });

        log('Test pagina geladen. Kies een PDF bestand.');
    </script>
</body>

</html>